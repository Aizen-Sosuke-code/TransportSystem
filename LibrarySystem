using System;
using System.Collections.Generic;
using System.Linq;

namespace LibrarySystem
{
    // -----------------------------
    // 1. –ö–ª–∞—Å—Å Book (–ö–Ω–∏–≥–∞)
    // -----------------------------
    public class Book
    {
        public string Title { get; private set; }
        public string Author { get; private set; }
        public string ISBN { get; private set; }
        public int Copies { get; private set; }

        public Book(string title, string author, string isbn, int copies)
        {
            Title = title;
            Author = author;
            ISBN = isbn;
            Copies = copies;
        }

        public bool IsAvailable()
        {
            return Copies > 0;
        }

        public void TakeCopy()
        {
            if (Copies > 0)
                Copies--;
        }

        public void ReturnCopy()
        {
            Copies++;
        }

        public void ShowInfo()
        {
            Console.WriteLine($"–ù–∞–∑–≤–∞–Ω–∏–µ: {Title}");
            Console.WriteLine($"–ê–≤—Ç–æ—Ä: {Author}");
            Console.WriteLine($"ISBN: {ISBN}");
            Console.WriteLine($"–î–æ—Å—Ç—É–ø–Ω–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤: {Copies}");
        }
    }

    // -----------------------------
    // 2. –ö–ª–∞—Å—Å Reader (–ß–∏—Ç–∞—Ç–µ–ª—å)
    // -----------------------------
    public class Reader
    {
        public string Name { get; private set; }
        public int ReaderId { get; private set; }

        public Reader(string name, int readerId)
        {
            Name = name;
            ReaderId = readerId;
        }

        public void ShowInfo()
        {
            Console.WriteLine($"–ß–∏—Ç–∞—Ç–µ–ª—å: {Name}, ID: {ReaderId}");
        }
    }

    // -----------------------------
    // 3. –ö–ª–∞—Å—Å Library (–ö–æ–º–ø–æ–∑–∏—Ü–∏—è)
    // -----------------------------
    public class Library
    {
        private List<Book> books;
        private List<Reader> readers;

        public Library()
        {
            books = new List<Book>();
            readers = new List<Reader>();
        }

        public void AddBook(Book book)
        {
            books.Add(book);
            Console.WriteLine($"–ö–Ω–∏–≥–∞ \"{book.Title}\" –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É");
        }

        public void RemoveBook(string isbn)
        {
            var book = books.FirstOrDefault(b => b.ISBN == isbn);
            if (book != null)
            {
                books.Remove(book);
                Console.WriteLine($"–ö–Ω–∏–≥–∞ \"{book.Title}\" —É–¥–∞–ª–µ–Ω–∞");
            }
            else
            {
                Console.WriteLine("–ö–Ω–∏–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞");
            }
        }

        public void RegisterReader(Reader reader)
        {
            readers.Add(reader);
            Console.WriteLine($"–ß–∏—Ç–∞—Ç–µ–ª—å {reader.Name} –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω");
        }

        public void RemoveReader(int readerId)
        {
            var reader = readers.FirstOrDefault(r => r.ReaderId == readerId);
            if (reader != null)
            {
                readers.Remove(reader);
                Console.WriteLine($"–ß–∏—Ç–∞—Ç–µ–ª—å {reader.Name} —É–¥–∞–ª–µ–Ω");
            }
            else
            {
                Console.WriteLine("–ß–∏—Ç–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω");
            }
        }

        public void LendBook(string isbn, int readerId)
        {
            var book = books.FirstOrDefault(b => b.ISBN == isbn);
            var reader = readers.FirstOrDefault(r => r.ReaderId == readerId);

            if (book == null)
            {
                Console.WriteLine("–ö–Ω–∏–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞");
                return;
            }

            if (reader == null)
            {
                Console.WriteLine("–ß–∏—Ç–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω");
                return;
            }

            if (!book.IsAvailable())
            {
                Console.WriteLine($"–ö–Ω–∏–≥–∞ \"{book.Title}\" —Å–µ–π—á–∞—Å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");
                return;
            }

            book.TakeCopy();
            Console.WriteLine($"–ö–Ω–∏–≥–∞ \"{book.Title}\" –≤—ã–¥–∞–Ω–∞ —á–∏—Ç–∞—Ç–µ–ª—é {reader.Name}");
        }

        public void ReturnBook(string isbn)
        {
            var book = books.FirstOrDefault(b => b.ISBN == isbn);

            if (book != null)
            {
                book.ReturnCopy();
                Console.WriteLine($"–ö–Ω–∏–≥–∞ \"{book.Title}\" –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É");
            }
            else
            {
                Console.WriteLine("–ö–Ω–∏–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞");
            }
        }

        public void ShowAllBooks()
        {
            Console.WriteLine("\nüìö –°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ:");
            foreach (var book in books)
            {
                book.ShowInfo();
                Console.WriteLine("-----------------------");
            }
        }

        public void ShowAllReaders()
        {
            Console.WriteLine("\nüë§ –°–ø–∏—Å–æ–∫ —á–∏—Ç–∞—Ç–µ–ª–µ–π:");
            foreach (var reader in readers)
            {
                reader.ShowInfo();
            }
        }
    }

    // -----------------------------
    // 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    // -----------------------------
    class Program
    {
        static void Main(string[] args)
        {
            Library library = new Library();

            Book book1 = new Book("Clean Code", "Robert C. Martin", "111", 3);
            Book book2 = new Book("Design Patterns", "GoF", "222", 2);
            Book book3 = new Book("C# in Depth", "Jon Skeet", "333", 1);

            library.AddBook(book1);
            library.AddBook(book2);
            library.AddBook(book3);

            Reader reader1 = new Reader("–ê–ª–∏–±–µ–∫", 1);
            Reader reader2 = new Reader("–ú–∞–¥–∏–Ω–∞", 2);

            library.RegisterReader(reader1);
            library.RegisterReader(reader2);

            library.ShowAllBooks();
            library.ShowAllReaders();

            Console.WriteLine("\nüìñ –í—ã–¥–∞—á–∞ –∫–Ω–∏–≥:");
            library.LendBook("111", 1);
            library.LendBook("222", 2);
            library.LendBook("333", 1);
            library.LendBook("333", 2); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

            Console.WriteLine("\nüîÑ –í–æ–∑–≤—Ä–∞—Ç –∫–Ω–∏–≥–∏:");
            library.ReturnBook("333");

            Console.WriteLine("\n‚ùå –£–¥–∞–ª–µ–Ω–∏–µ:");
            library.RemoveBook("222");
            library.RemoveReader(2);

            library.ShowAllBooks();
            library.ShowAllReaders();

            Console.WriteLine("\n–ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–ª–∞–≤–∏—à—É –¥–ª—è –≤—ã—Ö–æ–¥–∞...");
            Console.ReadKey();
        }
    }
}

